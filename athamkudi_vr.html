<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Athankudi Palace VR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  </head>
  <body>

    <audio id="main_audio"></audio>

    <a-scene>

      <a-sky id="sky" rotation="0 -90 0"></a-sky>

      <a-entity id="cameraRig">
        <a-entity 
          id="camera"
          camera="fov: 40"
          look-controls
          position="0 1.0 0">
        </a-entity>
      </a-entity>

      <a-entity laser-controls="hand: left" raycaster="objects: .clickable" line="color: white; opacity: 0.9"></a-entity>
      <a-entity laser-controls="hand: right" raycaster="objects: .clickable" line="color: white; opacity: 0.9"></a-entity>

      <!-- Navigation buttons -->
      <a-plane
        class="clickable"
        id="top"
        src="./next.png"
        position="2 1 -4"
        width="0.5"
        height="0.5"
        rotation="0 0 90"
        material="opacity: 0.8; transparent: true">
      </a-plane>

      <a-plane
        class="clickable"
        id="bottom"
        src="./next.png"
        position="2 0 -4"
        width="0.5"
        height="0.5"
        rotation="0 -0.5 -90"
        material="opacity: 0.8; transparent: true">
      </a-plane>

      <a-plane
        class="clickable"
        id="right"
        src="./next.png"
        position="2.5 0.5 -4"
        width="0.5"
        height="0.5"
        rotation="0 0 0"
        material="opacity: 0.8; transparent: true">
      </a-plane>

      <a-plane
        class="clickable"
        id="left"
        src="./next.png"
        position="1.5 0.5 -4"
        width="0.5"
        height="0.5"
        rotation="0 0 -180"
        material="opacity: 0.8; transparent: true">
      </a-plane>

      <!-- Audio button -->
      <a-entity id="audio_button" visible="false" position="-2 1 -4">
        <a-circle
          radius="0.12"
          color="#ffffff"
          class="clickable"
          material="shader: flat; opacity: 0.7">
        </a-circle>
        <a-plane
          class="clickable"
          src="./images/icons/audio.png"
          width="0.1"
          height="0.1"
          position="0 0 0.001"
          material="shader: flat"
          transparent="true">
        </a-plane>
      </a-entity>

      <!-- Zoom controls panel -->
      <a-entity id="zoom_panel" position="0 1.5 -4" visible="true">
        <!-- Panel background -->
        <a-plane 
          width="0.8" 
          height="0.3" 
          color="#333333" 
          opacity="0.7"
          position="0 0 0">
        </a-plane>
        
        <!-- Zoom in button -->
        <a-entity class="clickable zoom-button" id="zoom_in" position="-0.2 0 0.01">
          <a-circle
            radius="0.1"
            color="#ffffff"
            material="shader: flat; opacity: 0.7">
          </a-circle>
          <a-text
            value="+"
            align="center"
            color="black"
            position="0 0 0.01"
            width="2"
            scale="0.2 0.2 0.2">
          </a-text>
        </a-entity>
        
        <!-- Zoom out button -->
        <a-entity class="clickable zoom-button" id="zoom_out" position="0.2 0 0.01">
          <a-circle
            radius="0.1"
            color="#ffffff"
            material="shader: flat; opacity: 0.7">
          </a-circle>
          <a-text
            value="-"
            align="center"
            color="black"
            position="0 0 0.01"
            width="2"
            scale="0.2 0.2 0.2">
          </a-text>
        </a-entity>
        
        <!-- Zoom label -->
        <a-text
          value="ZOOM"
          align="center"
          color="white"
          position="0 -0.15 0.01"
          width="2"
          scale="0.15 0.15 0.15">
        </a-text>
      </a-entity>

    </a-scene>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const sky = document.getElementById("sky");
        const left = document.getElementById("left");
        const right = document.getElementById("right");
        const top = document.getElementById("top");
        const bottom = document.getElementById("bottom");
        const audio_button = document.getElementById('audio_button');
        const zoomInButton = document.getElementById('zoom_in');
        const zoomOutButton = document.getElementById('zoom_out');
        const camera = document.querySelector('[camera]');
        
        let audio_button_value = 0;
        let audio_number = 0;
        const main_audio = document.getElementById('main_audio');

        let left_value = right_value = top_value = bottom_value = 0;
        let left_location = right_location = top_location = bottom_location = '';

        // Zoom variables
        const minFov = 10;
        const maxFov = 80;
        const zoomStep = 5;
        let currentFov = 40;

        function update_images(){
          main_audio.pause();
          main_audio.currentTime = 0;
          left.setAttribute('visible', left_value !== 0);
          right.setAttribute('visible', right_value !== 0);
          top.setAttribute('visible', top_value !== 0);
          bottom.setAttribute('visible', bottom_value !== 0);
        }

        const functions = {
          scene1: function() {
            audio_number = 1;
            audio_button_value = 1;
            top_value = 1;
            bottom_value = left_value = right_value = 0;
            sky.setAttribute('src','./images/scene/1.png');
            top_location = 'scene2';
            left_location = right_location = bottom_location = '';
            update_images();
            update_audio();
          },

          scene2: function(){
            audio_button_value = 0;
            audio_number = 0;
            top_value = bottom_value = 1;
            left_value = right_value = 0;
            sky.setAttribute('src','./images/scene/2.png');
            top_location = 'scene3';
            bottom_location = 'scene1';
            left_location = right_location = '';
            update_images();
            update_audio();
          },

          scene3: function(){
            audio_button_value = 1;
            audio_number = 2;
            top_value = bottom_value = 1;
            left_value = right_value = 0;
            sky.setAttribute('src','./images/scene/3.png');
            top_location = 'scene4';
            bottom_location = 'scene2';
            left_location = right_location = '';
            update_images();
            update_audio();
          },

          scene4: function(){
            audio_button_value = 0;
            audio_number = 0;
            top_value = bottom_value = left_value = right_value = 1;
            sky.setAttribute('src','./images/scene/4.png');
            top_location = 'scene8';
            left_location = 'scene6';
            right_location = 'scene5';
            bottom_location = 'scene3';
            update_images();
            update_audio();
          },

           scene5: function(){
            audio_button_value = 0;
            audio_number = 0;
            left_value = 1;
            top_value = bottom_value = right_value = 0;
            sky.setAttribute('src','./images/scene/5.png');
            left_location = 'scene4';
            right_location = top_location = bottom_location = '';
            update_images();
            update_audio();
          },

          scene6: function(){
            audio_button_value = 1;
            audio_number = 3;
            right_value = 1;
            top_value = bottom_value = left_value = 0;
            sky.setAttribute('src','./images/scene/6.png');
            right_location = 'scene4';
            left_location = top_location = bottom_location = '';
            update_images();
            update_audio();
          },

          scene7: function(){
            audio_button_value = 1;
            audio_number = 5;
            right_value = 1;
            top_value = bottom_value = left_value = 0;
            sky.setAttribute('src','./images/scene/7.png');
            right_location = 'scene8';
            left_location = top_location = bottom_location = '';
            update_images();
            update_audio();
          },

          scene8: function(){
            audio_number = 1;
            audio_number = 4;
            top_value = bottom_value = left_value = 1;
            right_value = 0;
            sky.setAttribute('src','./images/scene/8.png');
            top_location = 'scene9';
            left_location = 'scene7';
            right_location = '';
            bottom_location = 'scene5';
            update_images();
            update_audio();
          },

          scene9: function(){
            audio_button_value = 1;
            audio_number = 6;
            top_value = bottom_value  = 1;
            right_value = left_value = 0;
            sky.setAttribute('src','./images/scene/9.png');
            top_location = 'scene10';
            left_location = '';
            right_location = '';
            bottom_location = 'scene8';
            update_images();
            update_audio();
          },
          
          scene10: function(){
            audio_button_value = 0;
            audio_number = 0;
            bottom_value  = 1;
            right_value = left_value = top_value = 0;
            sky.setAttribute('src','./images/scene/10.png');
            top_location = left_location = right_location = ''; 
            bottom_location = 'scene9';
            update_images();
            update_audio();
          }
        }

        functions.scene1();

        // Navigation event listeners
        top.addEventListener('click', () => handleDirectionClick(top_location));
        left.addEventListener('click', () => handleDirectionClick(left_location));
        right.addEventListener('click', () => handleDirectionClick(right_location));
        bottom.addEventListener('click', () => handleDirectionClick(bottom_location));

        function handleDirectionClick(location) {
          if (location && functions[location]) {
            functions[location]();
          }
        }

        function update_audio() {
          audio_button.setAttribute('visible', audio_button_value == 1);
        }

        audio_button.addEventListener('click', function() {
          if (audio_number == 0) {
            console.log('No audio for this scene');
          } else {
            main_audio.src = `./audio/${audio_number}.wav`;
            main_audio.play().catch(e => console.log('Audio play failed:', e));
          }
        });

        // Zoom functionality
        zoomInButton.addEventListener('click', function() {
          currentFov = Math.max(minFov, currentFov - zoomStep);
          camera.setAttribute('camera', 'fov', currentFov);
        });

        zoomOutButton.addEventListener('click', function() {
          currentFov = Math.min(maxFov, currentFov + zoomStep);
          camera.setAttribute('camera', 'fov', currentFov);
        });
      });
    </script>
  </body>
</html>